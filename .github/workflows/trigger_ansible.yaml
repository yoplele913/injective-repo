name: Trigger Ansible Playbook for Injective

on:
  push:
    branches:
      - main  # main 브랜치에 Push될 때 실행

jobs:
  trigger-ansible:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: SSH into Ansible Main Node and Run Playbook
        run: |
          ssh -o StrictHostKeyChecking=no ubuntu@192.168.187.134 << 'EOF'
            cd /home/ubuntu/injectived
            git pull  # 최신 코드 가져오기
            ansible-playbook -i inventory.ini deploy_injective.yaml
          EOF
        env:
          ANSIBLE_USER: ubuntu
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
